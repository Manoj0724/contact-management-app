<div class="app-layout" (click)="closeAllMenus()">

  <!-- SIDEBAR OVERLAY (mobile) -->
  <div
    class="sidebar-overlay"
    [class.visible]="sidebarOpen"
    (click)="closeSidebar()">
  </div>

  <!-- SIDEBAR -->
  <aside class="sidebar" [class.open]="sidebarOpen" (click)="$event.stopPropagation()">
    <div class="sidebar-logo">
      <div class="logo-icon">
        <mat-icon>contacts</mat-icon>
      </div>
      <div class="logo-text">
        <h2>ContactsPro</h2>
        <p>Contact Management</p>
      </div>
    </div>

    <nav class="sidebar-nav">
      <a
        routerLink="/contacts"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        class="menu-item"
        (click)="clearGroupFilter(); closeSidebar()"
      >
        <mat-icon>people</mat-icon>
        <span>All Contacts</span>
        <span class="nav-badge">{{ totalContactsCount }}</span>
      </a>

      <a routerLink="/contacts/new" routerLinkActive="active" class="menu-item" (click)="closeSidebar()">
        <mat-icon>person_add</mat-icon>
        <span>Add Contact</span>
      </a>

      <a routerLink="/contacts/bulk-upload" routerLinkActive="active" class="menu-item" (click)="closeSidebar()">
        <mat-icon>upload_file</mat-icon>
        <span>Bulk Upload</span>
      </a>

      <button
        class="menu-item menu-btn"
        (click)="toggleFavorites()"
        [class.active]="showOnlyFavorites"
      >
        <mat-icon>{{ showOnlyFavorites ? 'star' : 'star_border' }}</mat-icon>
        <span>{{ showOnlyFavorites ? 'Show All' : 'Favorites' }}</span>
      </button>

      <div class="sidebar-divider"></div>

      <div class="groups-header-row">
        <span class="groups-label">GROUPS</span>
        <button class="add-group-btn" (click)="openCreateGroupDialog(); $event.stopPropagation()" title="Create new group">
          <mat-icon>add</mat-icon>
        </button>
      </div>

      <div *ngIf="groups.length === 0" class="empty-groups">
        <mat-icon>folder_open</mat-icon>
        <span>No groups yet</span>
      </div>

      <div *ngFor="let group of groups" class="group-row">
        <a
          class="menu-item group-item"
          [style.--group-color]="group.color"
          (click)="filterByGroup(group._id, group.name); closeSidebar()"
        >
          <span class="group-dot" [style.background]="group.color"></span>
          <span class="group-name">{{ group.name }}</span>
          <span
            class="nav-badge"
            [style.background]="group.color + '33'"
            [style.color]="group.color"
          >
            {{ group.contactCount }}
          </span>
        </a>
        <button class="group-menu-btn" (click)="toggleGroupMenu(group._id, $event)" title="Options">
          <mat-icon>more_vert</mat-icon>
        </button>
        <div class="group-dropdown" *ngIf="activeGroupMenu === group._id">
          <button class="dropdown-item edit-item" (click)="openEditGroupDialog(group, $event)">
            <mat-icon>edit</mat-icon>
            <span>Rename</span>
          </button>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item delete-item" (click)="deleteGroup(group, $event)">
            <mat-icon>delete_outline</mat-icon>
            <span>Delete</span>
          </button>
        </div>
      </div>

      <div class="sidebar-divider"></div>

      <button class="menu-item menu-btn" (click)="exportCSV()">
        <mat-icon>download</mat-icon>
        <span>Export CSV</span>
      </button>
    </nav>

    <div class="sidebar-footer">
      <p>Version 1.3.0</p>
    </div>
  </aside>

  <!-- RIGHT SIDE WRAPPER -->
  <div class="content-wrapper">

    <!-- MOBILE HEADER - only shows on mobile -->
    <div class="mobile-header">
      <button class="mobile-menu-btn" (click)="toggleSidebar(); $event.stopPropagation()">
        <mat-icon>menu</mat-icon>
      </button>
      <span class="mobile-header-title">ContactsPro</span>
    </div>

    <!-- MAIN CONTENT -->
    <main class="main-content">
      <router-outlet></router-outlet>
    </main>

  </div>

</div>
